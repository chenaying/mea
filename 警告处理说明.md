# CLIP 警告处理说明

## 一、警告信息

运行 `viecap_inference_adapted.py` 时可能出现以下警告：

```
UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
```

## 二、警告原因

这个警告来自 **CLIP 库内部**（`clip/clip.py`），不是我们代码的问题。CLIP 库使用了即将被弃用的 `pkg_resources` 包，这是 setuptools 的一个 API 变更。

**重要**：这只是一个 **警告（Warning）**，不是错误（Error）。程序会**正常继续运行**，不会影响功能。

## 三、解决方案

### 方案 1：忽略警告（推荐）

这是最简单的方案。警告不会影响程序运行，可以直接忽略。

### 方案 2：抑制警告（已在代码中添加）

我已经在 `viecap_inference_adapted.py` 中添加了警告抑制代码：

```python
import warnings
warnings.filterwarnings("ignore", category=UserWarning, message=".*pkg_resources.*")
```

这样就不会显示这个警告了。

### 方案 3：运行时抑制（命令行）

如果不想修改代码，可以在运行时抑制警告：

```bash
python -W ignore::UserWarning viecap_inference_adapted.py \
    --memory_id coco \
    --memory_caption_num 5 \
    --using_hard_prompt \
    --image_path ./images/instance1.jpg \
    --weight_path ./checkpoints/train_coco/coco_prefix-0014.pt
```

### 方案 4：降级 setuptools（不推荐）

理论上可以降级 setuptools 到 <81 版本来避免警告，但这可能影响其他包的兼容性，**不推荐**。

## 四、验证程序是否正常运行

如果程序正常，你应该看到：

1. **模型加载信息**：
   ```
   Load CLIP from the checkpoint ViT-B/32.
   Load sentenceBERT from the checkpoint sentence-transformers/all-MiniLM-L6-v2.
   Load Textual Scene Graph parser from the checkpoint lizhuang144/flan-t5-base-VG-factual-sg.
   ```

2. **记忆库加载**：
   ```
   （如果记忆库存在）
   ```

3. **概念提取**：
   ```
   memory concepts: ['dog', 'park', 'person', ...]
   ```

4. **生成描述**：
   ```
   the generated caption: A dog is running in a park.
   ```

## 五、如果遇到其他错误

### 错误 1：模块未找到

```
ModuleNotFoundError: No module named 'utils.detect_utils'
```

**解决**：确保已复制 `utils/detect_utils.py` 和 `models/clip_utils.py` 文件。

### 错误 2：记忆库文件未找到

```
FileNotFoundError: data/memory/coco/memory_captions.json
```

**解决**：使用 MeaCap-main 的 `prepare_embedding.py` 生成记忆库文件。

### 错误 3：CUDA 内存不足

```
torch.OutOfMemoryError: CUDA out of memory
```

**解决**：
- 减小 `--memory_caption_num` 参数
- 或使用较小的记忆库（如 `coco` 而不是 `cc3m`）

## 六、总结

- ✅ **警告不影响运行**：这只是 deprecation warning，程序会正常执行
- ✅ **已添加警告抑制**：代码已更新，不会显示警告
- ✅ **可以正常使用**：如果看到模型加载信息，说明程序正在正常运行

**建议**：直接忽略这个警告，关注程序的实际输出和结果。

